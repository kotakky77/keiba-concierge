## アプリ「競馬幹事コンシェルジュ」機能要件定義書

### 1. アプリ概要
競馬イベント（主に競馬場へのグループ観戦）の幹事業務を円滑化し、参加者とのコミュニケーションや精算作業をサポートするアプリケーション。固有のイベントURLを通じて、ログインせずに主要機能を利用可能。任意でユーザーアカウントを作成・ログインすることで、過去イベント履歴の参照が可能となる。

### 2. ターゲットユーザー
* 競馬イベント（観戦会など）の幹事
* 競馬イベントの参加者

### 3. 全体要件
* **プラットフォーム:** スマートフォンアプリ (iOS, Android - ※要検討) またはWebアプリケーション
* **データ管理:**
    * 全てのイベント情報（日程候補、参加者リスト、持ち物リスト、精算情報等）は、ユーザーのログイン状態に関わらず、サーバーサイドのデータベースで永続的に管理する。
    * 非ログインユーザー（ゲスト）は、共有された固有のイベントURLを通じて、該当イベントの情報にアクセスし、機能を利用する。
* **ログイン:**
    * 原則、固有のイベントURLがあればログイン不要で関連機能（日程調整への回答、持ち物担当表明、精算状況確認など）を利用可能とする。
    * 任意でユーザーアカウントを作成し、ログインできる機能を提供する。
    * **ログインするメリット:** 自分が作成または参加した過去のイベント履歴を一覧で確認できる機能（※現バージョンではこの機能に限定）。
* **外部連携:** 現時点では、予約システムや決済システムとの連携は行わない。

### 4. 機能要件詳細

#### 4.1. イベント作成・管理
* 幹事（ログイン状態は問わない）は新規イベントを作成できる。
* イベント作成時に、第三者が容易に推測できない **十分に長く複雑な一意のURL** を生成する。このURLがイベントへのアクセスキーとなる。
* イベントURLを知っているユーザーは、該当イベントの情報（日程、場所、参加者、持ち物、精算状況など）を一覧・詳細表示できる。
* （ログイン時）自分が過去に作成または参加したイベントの履歴（イベント名、日付、URLへのリンク等）を一覧で確認できる。

#### 4.2. 日程調整機能
* **候補日提案:** 幹事はイベントページ内で、複数の開催候補日（日付・時間）を提示できる。
* **出欠確認:** イベントURLにアクセスした参加者は、各候補日に対して出欠（例：〇、△、×）と名前（ニックネーム可）を入力できる。コメント欄も設ける。入力された情報はサーバーに保存される。
* **結果表示:** イベントURLにアクセスすれば、誰でも候補日ごとの出欠状況を一覧で確認できる。
* **日程決定:** 幹事は集まった回答をもとに開催日時を決定し、システム上で確定できる。確定された日時はイベントページに反映され、アクセスした全ユーザーが確認できる。

#### 4.3. レーシングカレンダー連携・開催案内機能
* **カレンダーデータ取込:**
  * JRAが提供するiCalendar形式のレーシングカレンダーファイルがjradata/YYYY配下フォルダに格納されている
    * jraraceYYYY.ics：競馬場が開催している日と開催している競馬場の情報
    * jrakaisaiYYYY.ics：開催している競馬場の中で、イベントがある情報（jraraceYYYY.icsにはあるが、jrakaisaiYYYY.icsにはない時は開催はあるがイベントないということ）
* **カレンダー表示:** アプリ内でJRAのレース開催日（日付、競馬場、主要レース名等）をカレンダー形式またはリスト形式で表示する。
* **開催案内作成補助:**
    * イベント作成時や日程調整の候補日選択時に、取り込んだレーシングカレンダー情報を参照・選択できる。
    * 選択したレース情報（日付、競馬場名、主要レース名など）をイベント情報に簡単に紐付け、参加者への案内文（イベントページ内）に含めることができるようにする。

#### 4.4. 持ち物リクエスト・管理機能
* **リクエスト登録:** 幹事はイベントページ内で、参加者に持ってきてほしい飲食物や物品をリスト形式で登録できる。数量の指定も可能とする。
* **担当表明:** イベントURLにアクセスした参加者はリストを見て、自分が担当できる項目を選択し、名前を入力する。情報はサーバーに保存される。
* **状況表示:** イベントページには、どの項目を誰が担当するかがリアルタイムで表示され、重複や不足を把握しやすくする。

#### 4.5. 精算設定・管理機能
* **費用登録:**
    * 幹事（またはイベントURLを知る支払いを行った参加者）は、イベントページ内で発生した費用項目と金額、立て替えた人（支払者）を登録できる。
    * 参加者リスト（日程調整や持ち物リストで入力された名前を利用）が表示され、支払者を選択する。
* **精算方法設定:**
    * 幹事は精算方法を設定できる（例：「参加者全員で均等割り」「特定の費用は一部メンバーのみで割る」「個別金額設定」など）。
* **割勘計算:** 登録された費用と精算方法に基づき、各参加者が最終的に支払うべき金額、または受け取るべき金額を自動計算する。イベントページ内で、誰が誰にいくら支払う必要があるかを明確に表示する。
* **支払状況管理:**
    * 各支払い項目について、「支払い済み」「未払い」のステータスを管理できる機能（チェックボックス等）をイベントページに設ける。
    * 幹事または参加者自身が支払い完了をマークできるようにする。
    * イベント全体の精算完了状況をイベントページで可視化する。

### 5. セキュリティ要件
* **アクセス制御:** イベント情報へのアクセスは、原則として、該当イベント固有の **長く複雑な（推測困難な）URL** を知っているユーザーに限定する。
* **通信の暗号化:** クライアント（アプリ/ブラウザ）とサーバー間の全ての通信は **HTTPS** を使用して暗号化する。

### 6. 非機能要件（考慮事項）
* **ユーザビリティ:** ログイン不要での利用が主となるため、直感的で分かりやすいインターフェースを最優先とする。イベントURLの共有方法も簡便にする。
* **データ更新:** JRAカレンダーの更新頻度と、アプリへの反映タイミング、更新失敗時のハンドリングを定義する。
* **パフォーマンス:** 複数ユーザーが同時にアクセス・更新した場合の応答性を考慮する。
* **エラーハンドリング:** JRAカレンダーのURL変更やファイル形式変更、ダウンロード失敗時の対応を考慮する。